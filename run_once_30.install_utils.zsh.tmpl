#!/usr/bin/env zsh

if [ -f /bin/zsh ]; then
  chsh -s /bin/zsh
elif [ -f /usr/bin/zsh ; then
  chsh -s /usr/bin/zsh
else
  chsh -s $(which zsh)
fi
# External plugins (initialized before)
if [ "$(command -v curl)" ]; then
  export WEB_INSTALLER="curl -L"
elif [ "$(command -v wget)" ]; then
  export WEB_INSTALLER="wget -qO-"
else
  echo "To install we need curl or wget to be installed to proceed." >&2
  exit 1
fi

##############################
# Starship prompt            #
##############################
mkdir -p $HOME/.bin
if ! type starship &> /dev/null; then
  {{ if eq .chezmoi.arch "arm64" }}
  brew install -s --build-from-source starship
  {{ end }}
  {{ if ne .chezmoi.arch "arm64" }}
  brew install -s starship
  {{ end }}
fi

##############################
# ZINIT                      #
##############################
if [ ! -d $HOME/.zinit/bin ]; then
  mkdir -p $HOME/.zinit
  git clone https://github.com/zdharma/zinit.git $HOME/.zinit/bin
fi

##############################
# tools auto install    #
##############################
if [ ! -f $HOME/.fzf.zsh ]; then
  $(brew --prefix)/opt/fzf/install --completion --key-bindings --no-update-rc --no-bash --no-fish
fi

if ! type mdv &> /dev/null; then
  echo "Installing 'mdv'..."
  pip3 install --user mdv
fi

[ ! -d $HOME/.autoload-zsh ] && mkdir -p $HOME/.autoload-zsh
if [ ! -f "$HOME/.autoload-zsh/_fzf_compgen_path" ]; then
  echo "#! /usr/bin/env zsh" > $HOME/.autoload-zsh/_fzf_compgen_path
  declare -f _fzf_compgen_path >> $HOME/.autoload-zsh/_fzf_compgen_path
fi

if [ ! -f "$HOME/.autoload-zsh/_fzf_compgen_dir" ]; then
  echo "#! /usr/bin/env zsh" > $HOME/.autoload-zsh/_fzf_compgen_dir
  declare -f _fzf_compgen_dir >> $HOME/.autoload-zsh/.
fi


